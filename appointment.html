<!DOCTYPE html>
<html lang="en">

<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <link rel="stylesheet" href="css/appointment.css">
     <title>Book Appointment</title>
     <style>
          .notification {
               position: fixed;
               top: 10px;
               right: 10px;
               background-color: #4CAF50;
               color: white;
               padding: 10px;
               border-radius: 5px;
               opacity: 0;
               transition: opacity 0.5s;
          }

          .notification.error {
               background-color: #f44336;
          }

          .notification.show {
               opacity: 1;
          }

          .appointment-item {
               margin-bottom: 20px;
               padding: 10px;
               border: 1px solid #ccc;
               border-radius: 5px;
          }

          .appointment-item p {
               margin: 5px 0;
          }

          .join-button {
               background-color: #007bff;
               font-size: large;
               color: white;
               border: none;
               height: 50px;
               width: 100px;
               padding: 5px 10px;
               border-radius: 3px;
               cursor: pointer;
          }

          .delete-button {
               background-color: #ff0000;
               margin: 25px;
               margin-right: 250pt;
               font-size: large;
               color: white;
               border: none;
               height: 50px;
               width: 100px;
               padding: 5px 10px;
               border-radius: 3px;
               cursor: pointer;
          }

          .delete-button:hover {
               background-color: #b30000;
          }

          .input-container {
               --c-text: rgb(50, 50, 80);
               --c-bg: rgb(252, 252, 252);
               --c-outline: rgb(55, 45, 190);
               display: grid;
               gap: 1ch;
               position: relative;
               max-width: 650px;
               font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
               color: black;
          }

          .input-field {
               padding: 0.5em 0.75em;
               border-radius: 0.2em;
               border: 1px solid var(--c-border, currentColor);
               color: var(--c-text);
               font-size: 1rem;
               letter-spacing: 0.1ch;
               width: 100%;
          }

          .input-field:not(:placeholder-shown)+.input-label {
               transform: translateY(-220%);
               opacity: 1;
          }

          .input-field:invalid {
               --c-border: rgb(230, 85, 60);
               --c-text: rgb(230, 85, 60);
               --c-outline: rgb(230, 85, 60);
          }

          .input-field:is(:disabled, :read-only) {
               --c-border: rgb(150, 150, 150);
               --c-text: rgb(170, 170, 170);
          }

          .input-field:is(:focus, :focus-visible) {
               outline: 2px solid var(--c-outline);
               outline-offset: 2px;
          }

          .input-label {
               --timing: 200ms ease-in;
               position: absolute;
               left: 0;
               top: 50%;
               transition: transform var(--timing),
                    opacity var(--timing);
               transform: translateY(-50%);
               opacity: 0;
               color: var(--c-text);
               font-weight: 500;
          }

          .calendar-container {
               max-width: 300px;
               margin: 20px auto;
          }

          .calendar {
               width: 100%;
               border-collapse: collapse;
          }

          .calendar th,
          .calendar td {
               padding: 10px;
               text-align: center;
               border: 1px solid #ddd;
          }

          .calendar th {
               background-color: #f4f4f4;
          }

          .calendar td {
               cursor: pointer;
          }

          .calendar .selected {
               background-color: #007bff;
               color: white;
          }

          .time-slots {
               display: flex;
               flex-wrap: wrap;
               gap: 10px;
               justify-content: center;
               margin-top: 20px;
          }

          .time-slot {
               padding: 10px 15px;
               border: 1px solid #ddd;
               border-radius: 5px;
               cursor: pointer;
               transition: background-color 0.3s;
          }

          .time-slot.selected {
               background-color: #007bff;
               color: white;
          }

          .time-slot.booked {
               background-color: #ccc;
               cursor: not-allowed;
          }
     </style>
</head>

<body>
     <form id="appointmentForm">
          <h1>Book Appointment</h1>
          <p class="input-container">
               <input type="text" placeholder="Enter your name" id="text" class="input-field" autocomplete="name">
          </p>
          <p class="input-container">
               <input type="email" placeholder="Enter your Email" id="email" class="input-field" autocomplete="email">
          </p>
          <div class="calendar-container">
               <input type="hidden" id="date" class="input-field">
               <div id="calendar"></div>
          </div>
          <div class="time-slots" id="timeSlots"></div>
          <p class="input-container">
               <input type="text" placeholder="Enter Doctor name" id="Doctor" class="input-field">
          </p>
          <p class="input-container">
               <input type="text" placeholder="Enter Google Meet Link" id="googleMeet" class="input-field">
          </p>
          <button type="submit">Book Appointment</button>
     </form>

     <div id="appointmentDisplay">
          <h2>Previous Appointments</h2>
          <div id="appointmentsList"></div>
     </div>

     <script>
          document.addEventListener('DOMContentLoaded', function () {
               displayAllAppointments();
               generateCalendar();
          });

          document.getElementById('appointmentForm').addEventListener('submit', function (event) {
               event.preventDefault();

               // Get form values
               const name = document.getElementById('text').value;
               const email = document.getElementById('email').value;
               const date = document.getElementById('date').value;
               const time = document.querySelector('.time-slot.selected') ? document.querySelector('.time-slot.selected').textContent : '';
               const doctor = document.getElementById('Doctor').value;
               const googleMeet = document.getElementById('googleMeet').value;

               // Simple validation
               if (name === '' || email === '' || date === '' || time === '' || doctor === '' || googleMeet === '') {
                    displayMessage('Please fill in all fields', 'error');
                    return;
               }

               // Check if the slot is already booked
               const appointments = JSON.parse(localStorage.getItem('appointments')) || [];
               const isBooked = appointments.some(appointment => appointment.date === date && appointment.time === time);
               if (isBooked) {
                    displayMessage('This slot is already booked', 'error');
                    return;
               }

               // Store appointment in local storage
               appointments.push({ name, email, date, time, doctor, googleMeet });
               localStorage.setItem('appointments', JSON.stringify(appointments));

               // Display success message
               displayMessage(`Appointment booked successfully for ${name} with ${doctor} on ${date} at ${time}`, 'success');

               // Display all appointments
               displayAllAppointments();

               // Clear form
               document.getElementById('appointmentForm').reset();
               clearSelectedSlots();
          });

          function displayMessage(message, type) {
               // Create notification element
               const notification = document.createElement('div');
               notification.className = `notification ${type} show`;
               notification.textContent = message;

               // Append notification to body
               document.body.appendChild(notification);

               // Remove notification after 3 seconds
               setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                         document.body.removeChild(notification);
                    }, 500);
               }, 3000);
          }

          function displayAllAppointments() {
               const appointments = JSON.parse(localStorage.getItem('appointments')) || [];

               const appointmentsList = document.getElementById('appointmentsList');
               appointmentsList.innerHTML = '';

               appointments.forEach((appointment, index) => {
                    const appointmentItem = document.createElement('div');
                    appointmentItem.className = 'appointment-item';
                    appointmentItem.innerHTML = `
                    <p><strong>Name:</strong> ${appointment.name}</p>
                    <p><strong>Email:</strong> ${appointment.email}</p>
                    <p><strong>Date:</strong> ${appointment.date}</p>
                    <p><strong>Time:</strong> ${appointment.time}</p>
                    <p><strong>Doctor:</strong> ${appointment.doctor}</p>
                    <button class="join-button" onclick="openGoogleMeet('${appointment.googleMeet}')">Join</button>
                    <button class="delete-button" onclick="deleteAppointment(${index})">Delete</button>
                `;
                    appointmentsList.appendChild(appointmentItem);
               });
          }

          function deleteAppointment(index) {
               let appointments = JSON.parse(localStorage.getItem('appointments')) || [];
               appointments.splice(index, 1);
               localStorage.setItem('appointments', JSON.stringify(appointments));
               displayAllAppointments();
          }

          function openGoogleMeet(url) {
               window.open(url, '_blank');
          }

          function generateCalendar() {
               const calendar = document.getElementById('calendar');
               const dateInput = document.getElementById('date');

               const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
               const today = new Date();
               const month = today.getMonth();
               const year = today.getFullYear();

               const firstDay = new Date(year, month, 1).getDay();
               const lastDate = new Date(year, month + 1, 0).getDate();

               let html = '<table class="calendar">';
               html += '<tr>';
               days.forEach(day => html += `<th>${day}</th>`);
               html += '</tr><tr>';

               for (let i = 0; i < firstDay; i++) {
                    html += '<td></td>';
               }

               for (let i = 1; i <= lastDate; i++) {
                    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                    html += `<td class="date-cell" data-date="${dateStr}">${i}</td>`;

                    if ((i + firstDay) % 7 === 0) {
                         html += '</tr><tr>';
                    }
               }

               html += '</tr></table>';
               calendar.innerHTML = html;

               document.querySelectorAll('.date-cell').forEach(cell => {
                    cell.addEventListener('click', function () {
                         document.querySelectorAll('.date-cell').forEach(c => c.classList.remove('selected'));
                         this.classList.add('selected');
                         dateInput.value = this.getAttribute('data-date');
                         generateTimeSlots();
                    });
               });
          }

          function generateTimeSlots() {
               const timeSlotsContainer = document.getElementById('timeSlots');
               const date = document.getElementById('date').value;
               const slots = ['11:30 AM', '12:30 PM', '1:30 PM', '4:30 PM', '5:30 PM', '6:30 PM'];
               const appointments = JSON.parse(localStorage.getItem('appointments')) || [];

               let html = '';

               slots.forEach(slot => {
                    const isBooked = appointments.some(appointment => appointment.date === date && appointment.time === slot);
                    const bookedClass = isBooked ? 'booked' : '';
                    html += `<div class="time-slot ${bookedClass}" data-time="${slot}">${slot}</div>`;
               });

               timeSlotsContainer.innerHTML = html;

               document.querySelectorAll('.time-slot:not(.booked)').forEach(slot => {
                    slot.addEventListener('click', function () {
                         document.querySelectorAll('.time-slot').forEach(s => s.classList.remove('selected'));
                         this.classList.add('selected');
                    });
               });
          }

          function clearSelectedSlots() {
               document.querySelectorAll('.date-cell, .time-slot').forEach(element => {
                    element.classList.remove('selected');
               });
          }
     </script>
</body>

</html>